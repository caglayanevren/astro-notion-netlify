---
import { getCollection } from 'astro:content';
import  Layout from "@layouts/Layout.astro";
import { getNotionPosts, type BlogPostDataType } from '@utils/notion';

const allPosts = await getNotionPosts();
// Sadece 'Published' olanları çek ve tarihe göre sırala
const filteredPosts = allPosts.filter(post => post.data.Status === 'Published');
const sortedPosts = filteredPosts.sort((a: { data: BlogPostDataType }, b: { data: BlogPostDataType }) => {
	const dateA = a.data.Date;
	const dateB = b.data.Date;
	if(dateA && dateB) 
	return dateA > dateB ? -1 : 1;
	return 0;
  });
---
<Layout>
	<h1>Blog Yazıları</h1>
	<ul>
	  {sortedPosts.map(post => (
		<li>
			<div style="display: flex;">
				<div><img src={`${post.data.Image}`} alt={`${post.data.Name}`} /></div>
				<a href={`/blog/${post.data.Slug}`}>
					<h2>{post.data.Name}</h2>
					<p>{post.data.Summary}</p>
					<time>{post.data.Date?.start?.toLocaleDateString()}</time>
				</a>
			</div>
		</li>
	  ))}
	</ul>
</Layout>